# Codebase Structure

## Directory Layout

```
src/
├── main.ts                    # Bootstrapper - discovers and imports all zone files
├── creds.json                 # Provider API credentials (excluded from git)
├── definitions/
│   └── dnscontrol.d.ts       # TypeScript type definitions for DNSControl functions
├── providers/
│   ├── cloudflare.ts         # Cloudflare DNS provider (standard and with redirects)
│   └── noregistrar.ts        # NoRegistrar for DNS-only management
├── services/                  # Service record definitions (replaces old records/)
│   ├── core.ts               # Server map and helper functions (GetHost, GetPrefix, GetIP, GetCoreRecords)
│   ├── infrastructure.ts     # Core infrastructure (router, TrueNAS, auth, vault, docker, uptime)
│   ├── homelab.ts            # Homelab services (Coder, Garage S3, Seq, Kasm, Zrok, AI)
│   ├── media-services.ts     # Media services (Calibre, Komga, Stash)
│   ├── productivity.ts       # Productivity tools (Atuin, Owncloud, OnlyOffice, MQTT, OpenWebUI, Kiwix)
│   ├── gaming.ts             # Gaming services (Drop, Romm)
│   ├── internal.ts           # Internal services (Traefik, NetbootXYZ, Portainer, PGAdmin)
│   ├── polaris-video.ts      # Polaris.video services (Plex, *arr stack, IPTV)
│   ├── mail/
│   │   ├── fastmail.ts       # Fastmail email configuration
│   │   └── postal.ts         # Postal self-hosted email configuration
│   ├── external/
│   │   ├── netlify-vladgg.ts # Netlify records for vlad.gg
│   │   └── cloudflare-pages.ts # Cloudflare Pages records
│   └── REPRISE               # Marker file (empty)
├── utils/
│   ├── record.ts             # Record interface, CreateRecord, CreateRecords functions
│   └── server.ts             # Server interface and ServerNames/ServerPrefixes types
└── zones/                     # Zone files (auto-discovered by main.ts)
    ├── polaris-gdn.ts        # Primary infrastructure domain
    ├── polaris-rest.ts       # Services domain
    ├── polaris-video.ts      # Media domain
    ├── polaris-express.ts    # DISABLED (all code commented out)
    ├── zhr-one.ts            # Infrastructure services
    ├── vlad-gg.ts            # Personal website
    ├── vlad-lgbt.ts          # Redirect to vlad.gg
    └── zaharia-email.ts      # Email-only domain

lib/
├── download.sh               # Downloads DNSControl binaries
├── dnscontrol-Darwin         # macOS binary (v4.30.0)
├── dnscontrol-Linux          # Linux binary (v4.30.0)
└── dnscontrol-VERSION        # Version file (4.30.0)

out/
├── dnsconfig.js              # Compiled output (generated by webpack)
└── creds.json                # Copied from src/creds.json
```

## Build Flow

1. `src/main.ts` uses webpack's require.context to discover all `.ts` files in `src/zones/`
2. Each zone file is imported and executed
3. Webpack compiles everything to `out/dnsconfig.js`
4. Platform-specific DNSControl binary executes the compiled JS
5. DNSControl applies changes via Cloudflare API
