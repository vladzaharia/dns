name: DNS Push

on:
  workflow_call:
    secrets:
      CF_API:
        description: "Cloudflare API token"
        required: true

jobs:
  push:
    name: Push DNS Changes
    runs-on: ubuntu-latest
    steps:
      - name: Download DNSControl binaries
        uses: actions/download-artifact@v4
        with:
          name: bin
          path: bin

      - name: Download compiled JS
        uses: actions/download-artifact@v4
        with:
          name: out
          path: out

      - name: Make binaries executable
        run: chmod +x dnscontrol-*
        working-directory: bin
        shell: bash

      - name: Push DNS changes
        working-directory: out
        shell: bash
        env:
          CF_API: ${{ secrets.CF_API }}
        run: |
          echo "ðŸš€ Pushing DNS changes to providers..."
          ../bin/dnscontrol-Linux --diff2 push
          echo "âœ… DNS changes pushed successfully!"

